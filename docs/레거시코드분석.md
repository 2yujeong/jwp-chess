# 기존 도메인 코드 분석

## Piece 패키지

- 추상클래스를 상속하고 있음

### 속성정보

- Boolean isFirstMove

### 역할

- 메소드: 각 기물에 맞는 움직임 가능 여부 확인 (Position curr, Position dest, Map<Position, Piece> 전체보드) => Boolean

1. 현재 포지션에서 이동가능한지 => Boolean
2. curr.길목의 위치를 받아옴 (dest 미포함) => List<Position>
3. 2번에서 받은 위치정보를 하나씩 전체보드 Map을 돌면서 장애물이 있는지 확인 => Boolean

## Team 패키지

- 각 팀에서 자신들의 말을 관리함 (class Team)

### 속성정보

- CapturedPieces: 자신의 팀에서 잡은 말을 모아둔 컬렉션
- PiecePositions: 자신의 살아있는 말들의 위치정보를 모아둔 컬렉션 Map<Position, Piece>
- Score: 각 팀의 점수

### 역할

- ChessGame과 사이에서 자신이 가진 속성 정보들을 관리해줌

### class PiecePositions

- 속성: Map<Position, Piece> 각 팀의 말의 위치정보를 가짐
- 역할
    - 해당 위치의 기물을 알려줌
    - 움직인 경우 기물의 위치정보를 업데이트하여 관리함
    - 캐슬링등 특수 케이스에 해당하는 메소드 가짐

### class Score

- 속성: 각 말의 점수 정보(static)
- 역할
    - 어떤 팀의 Map<Position, Piece>가 들어오면 해당 팀의 점수를 계산해줌

## 기타 기본 패키지

### class Position

- 가능한 위치 및 움직임을 담당
- 속성: int x, int y
- 역할
    - 이동한 위치를 반환
    - dest 까지의 십자, 대각, 거리1 등의 위치정보를 확인가능 => Boolean
    - 같은 column 에 위치하는지 확인 (Pawn 의 점수계산에 필요함) => Boolean
    - 위치가 끝에 도달했는지 확인 => Boolean
    - dest 까지의 사이 위치를 모아줌 => List<Position>
    - "a1" 등의 형태로 반환 가능

### class ChessGame

- 흑, 백팀을 모아서 move 및 통합처리 기능
- 속성
    - Team blackTeam
    - Team whiteTeam
    - Team currentTurn
    - Boolean isPlaying
- 역할
    - 실질적인 move 처리 (흑, 백팀의 위치정보를 모아서 확인 가능, 64개의 모든 정보를 가진 것은 없음)
    - turn 상태확인
    - 점수 및 각 팀의 리스트를 반환가능(Controller와 가장 인접한 도메인객체)

# JS(뷰) 관련

## json

```json
{
  "currentTurnTeam": "white",
  "isPlaying": true,
  "teamScore": {
    "black": 38,
    "white": 38
  },
  "piecePositionByTeam": {
    "black": {
      "a7": "Pawn",
      "a8": "Rook"
    },
    "white": {
      "a1": "Pawn",
      "a2": "Rook"
    }
  }
}
```

## alert

- 서버와의 연결 실패 -> "fail" 의 문자열이 들어있는 바디를 잡아서 alert
- `/move` -> 응답코드 200이 아니라면 이동할 수 없다고 alert

# DDL

```sql
CREATE
DATABASE chess_db;
USE
chess_db;
CREATE TABLE chess_game
(
    current_turn_team VARCHAR(5) NOT NULL,
    is_playing        boolean    NOT NULL
);
CREATE TABLE team_info
(
    team       VARCHAR(5)   NOT NULL,
    piece_info VARCHAR(400) NOT NULL,
    primary key (team)
);
```

- piece_info : 팀별로 각 가지고 있는 기물 정보를 저
  ` h7,Pawn,true/g7,Pawn,true/.../b8,Knight,true/a8,Rook,true/`

# dto 관련

## TeamDto
- white, black 글씨를 반환

## PieceDto
- Piece에 맞는 문자열(Pawn)를 반환

## DaoToPiece
- db에 있는 정보르 객체를 반환

## PiecePositionDaoConvertor
- 문자열 정보를 파싱해서 변환해주는 역할

## MoveRequestDto
- View에서 온 start, destination 문자열을 반환

## ChessGameTableDto
- current_turn_team, is_playing 등 DB와 관련(RowMapper 사용)

## ChessGameDto
- 전체 정보를 합쳐서 json과 같은 프로퍼티 타입으로 변경해주는 dto


